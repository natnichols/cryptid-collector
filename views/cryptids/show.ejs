<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<section>
  <h1><%= cryptid.name %> 👻</h1>
  <h3>Spotted by &nbsp;<img class="profile-photo" src="<%= cryptid.owner.avatar %>" alt="avatar of cryptid owner">
    <a href="/profiles/<%= cryptid.owner._id %>"><%= cryptid.owner.name %></a> on <%= cryptid.spotted.toLocaleString() %></h3>
  <p><%= cryptid.description %></p>
  <% if (cryptid.owner.equals(user?.profile._id)) { %>
    <a href="/cryptids/<%= cryptid._id %>/edit">
      <button class="btn">Edit Cryptid ✏️👻</button>
    </a>
    <form action="/cryptids/<%= cryptid._id %>?_method=DELETE" method="POST">
      <button class="btn" type="submit">Delete Cryptid ❌👽</button>
    </form>
  <% } %>
  <h2>Comments</h2>
  <ul>
    <% cryptid.comments?.forEach(comment => { %>
      <li>
        <%= comment.content %> -&nbsp;<img class="comment-photo" src="<%= comment.author.avatar %>" alt="avatar of commenter">
          <a href="/profiles/<%= comment.author._id %>"><%= comment.author.name %></a>&nbsp;at <%= comment.createdAt.toLocaleString() %>
          <% if (comment.author.equals(user?.profile._id)) { %>
            <a href="/cryptids/<%= cryptid._id %>/comments/<%= comment._id %>/edit">
              <button class="btn">✏️</button>
            </a>
            <form action="/cryptids/<%= cryptid._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
              <button class="btn" type="submit">❌</button>
            </form>
          <% } %>
      </li>
    <% }) %>
  </ul>
  <% if (user) { %>
    <h3>Add a comment</h3>
    <form action="/cryptids/<%= cryptid._id %>/comments" method="POST">
      <textarea name="content"></textarea>
      <label>
        Spotted?
        <!-- <input type="checkbox" name="spotted" <%# cryptid.comment.spotted ? "checked" : "" %>> -->
      </label>
      <button class="btn" type="submit">Add Comment</button>
    </form>
  <% } %>
</section>

<%- include('../partials/footer') %>